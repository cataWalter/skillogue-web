(()=>{var e={};e.id=750,e.ids=[750],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1440:(e,r,s)=>{"use strict";s.r(r),s.d(r,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>g,tree:()=>d}),s(8501),s(9909),s(6513),s(5866);var t=s(3191),a=s(8716),i=s(7922),n=s.n(i),l=s(5231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(r,o);let d=["",{children:["messages",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,8501)),"C:\\Users\\wcatalfamo\\Projects\\Personal\\skillogue-web\\src\\app\\messages\\page.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,9909)),"C:\\Users\\wcatalfamo\\Projects\\Personal\\skillogue-web\\src\\app\\messages\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,6513)),"C:\\Users\\wcatalfamo\\Projects\\Personal\\skillogue-web\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\wcatalfamo\\Projects\\Personal\\skillogue-web\\src\\app\\messages\\page.tsx"],u="/messages/page",m={require:s,loadChunk:()=>Promise.resolve()},g=new t.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/messages/page",pathname:"/messages",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},6873:(e,r,s)=>{Promise.resolve().then(s.bind(s,1219))},1869:(e,r,s)=>{Promise.resolve().then(s.bind(s,5596))},6333:(e,r,s)=>{"use strict";s.d(r,{Z:()=>t});let t=(0,s(2881).Z)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},2200:(e,r,s)=>{"use strict";s.d(r,{Z:()=>t});let t=(0,s(2881).Z)("flag",[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]])},7506:(e,r,s)=>{"use strict";s.d(r,{Z:()=>t});let t=(0,s(2881).Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},5601:(e,r,s)=>{"use strict";s.d(r,{Z:()=>t});let t=(0,s(2881).Z)("shield-alert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]])},1219:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>i});var t=s(326),a=s(3058);function i({children:e}){return t.jsx(a.Z,{children:e})}},5596:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>b});var t=s(326),a=s(7577),i=s.n(a),n=s(373),l=s(434),o=s(5047),d=s(6333),c=s(2200),u=s(7506),m=s(5601);let g=(0,s(2881).Z)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var f=s(1189),x=s(7437);let p=i().memo(({userId:e,fullName:r,lastMessage:s,unread:a,isSelected:i,onClick:n})=>t.jsx("div",{onClick:()=>n(e),className:`p-4 border-b border-gray-800 cursor-pointer hover:bg-gray-900 transition ${i?"bg-gray-900":""}`,children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[t.jsx(f.Z,{seed:e,className:"w-12 h-12"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex justify-between items-baseline",children:[t.jsx("h3",{className:"font-semibold truncate",children:r}),a>0&&t.jsx("span",{className:"bg-indigo-600 text-xs px-2 py-0.5 rounded-full",children:a})]}),t.jsx("p",{className:`text-sm truncate ${a>0?"text-white font-medium":"text-gray-400"}`,children:s})]})]})}));p.displayName="ConversationItem";let h=i().memo(({content:e,createdAt:r,isMe:s,showAvatar:a,senderId:i})=>(0,t.jsxs)("div",{className:`flex ${s?"justify-end":"justify-start"} mb-2`,children:[!s&&t.jsx("div",{className:"w-8 mr-2 flex-shrink-0",children:a&&t.jsx(f.Z,{seed:i,className:"w-8 h-8"})}),(0,t.jsxs)("div",{className:`max-w-[70%] px-4 py-2 rounded-2xl ${s?"bg-indigo-600 text-white rounded-br-none":"bg-gray-800 text-gray-200 rounded-bl-none"}`,children:[t.jsx("p",{children:e}),t.jsx("p",{className:`text-[10px] mt-1 ${s?"text-indigo-200":"text-gray-500"} text-right`,children:new Date(r).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]}));h.displayName="MessageItem";let b=()=>{let e=(0,o.useSearchParams)(),r=e?.get("conversation"),s=(0,o.useRouter)(),[i,b]=(0,a.useState)(null),[v,y]=(0,a.useState)([]),[j,_]=(0,a.useState)(r||null),[w,N]=(0,a.useState)([]),[k,P]=(0,a.useState)(""),[S,C]=(0,a.useState)(!1),[Z,q]=(0,a.useState)(!1),[E,O]=(0,a.useState)(1),[$,M]=(0,a.useState)(!0),[R,z]=(0,a.useState)(!1),[A,U]=(0,a.useState)(!1),[I,T]=(0,a.useState)(!1),F=(0,a.useRef)(null),D=(0,a.useRef)(!1),G=(0,a.useRef)(null);(0,a.useEffect)(()=>{(async()=>{let{data:e}=await n.O.auth.getUser();e?.user?b(e.user):s.push("/login")})()},[s]),(0,a.useEffect)(()=>{r&&_(r)},[r]);let H=(0,a.useCallback)(async()=>{if(!i)return;let{data:e,error:r}=await n.O.rpc("get_conversations",{current_user_id:i.id});r?console.error("Error loading conversations:",r):y(e||[])},[i]),L=(0,a.useCallback)(async()=>{if(!j||!i)return;let{error:e}=await n.O.rpc("mark_messages_as_read",{sender_id_param:j,receiver_id_param:i.id});e?console.error("Error marking messages as read:",e):H()},[j,i,H]);(0,a.useEffect)(()=>{if(i){H();let e=setInterval(H,15e3);return()=>clearInterval(e)}},[i,H]),(0,a.useEffect)(()=>{L()},[L]),(0,a.useEffect)(()=>{(async()=>{if(!j||!i||Z)return;1===E?C(!0):q(!0);let e=(E-1)*25,{data:r,error:s}=await n.O.from("messages").select(`
                    id,
                    created_at,
                    sender_id,
                    receiver_id,
                    content,
                    sender:profiles!sender_id(id, first_name, last_name),
                    receiver:profiles!receiver_id(id, first_name, last_name)
                `).or(`and(sender_id.eq.${i.id},receiver_id.eq.${j}),and(sender_id.eq.${j},receiver_id.eq.${i.id})`).order("created_at",{ascending:!1}).range(e,e+25-1);s?console.error("Error loading messages:",s):(1===E?N(r.reverse()):N(e=>[...r.reverse(),...e]),M(25===r.length)),C(!1),q(!1)})()},[j,i,E]),(0,a.useEffect)(()=>{(async()=>{if(!i||!j)return;let{data:e}=await n.O.from("blocks").select("*").eq("blocker_id",i.id).eq("blocked_id",j).single();U(!!e);let{data:r}=await n.O.from("blocks").select("*").eq("blocker_id",j).eq("blocked_id",i.id).single();z(!!r)})()},[i,j]),(0,a.useEffect)(()=>{if(!j||!i)return;let e=n.O.channel(`chat:${j}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`receiver_id=eq.${i.id}`},e=>{e.new.sender_id===j&&n.O.from("messages").select(`
                            id,
                            created_at,
                            sender_id,
                            receiver_id,
                            content,
                            sender:profiles!sender_id(id, first_name, last_name),
                            receiver:profiles!receiver_id(id, first_name, last_name)
                        `).eq("id",e.new.id).single().then(({data:e})=>{e&&(N(r=>[...r,e]),L())})}).subscribe();return()=>{n.O.removeChannel(e)}},[j,i,L]),(0,a.useLayoutEffect)(()=>{if(F.current){if(1!==E||D.current){if(G.current){let e=F.current.scrollHeight;F.current.scrollTop=e-G.current}}else F.current.scrollTop=F.current.scrollHeight}},[w,E]);let V=async e=>{if(e.preventDefault(),!k.trim()||!j||!i)return;let r=k.trim();P("");let s=Date.now(),t={id:s,created_at:new Date().toISOString(),sender_id:i.id,receiver_id:j,content:r,sender:{id:i.id,first_name:"You",last_name:""},receiver:{id:j,first_name:"",last_name:""}};N(e=>[...e,t]);let{error:a}=await n.O.from("messages").insert({sender_id:i.id,receiver_id:j,content:r});a?(console.error("Error sending message:",a),N(e=>e.filter(e=>e.id!==s)),alert("Failed to send message")):H()},Y=(0,a.useCallback)(e=>{_(e),O(1),N([]),M(!0),D.current=!1,s.push(`/messages?conversation=${e}`)},[s]),B=v.find(e=>e.user_id===j);return(0,t.jsxs)("div",{className:"flex h-[calc(100vh-64px)] bg-black text-white",children:[(0,t.jsxs)("div",{className:`w-full md:w-1/3 lg:w-1/4 border-r border-gray-800 flex flex-col ${j?"hidden md:flex":"flex"}`,children:[t.jsx("div",{className:"p-4 border-b border-gray-800",children:t.jsx("h2",{className:"text-xl font-bold",children:"Messages"})}),t.jsx("div",{className:"flex-grow overflow-y-auto",children:0===v.length?t.jsx("div",{className:"p-4 text-gray-400 text-center",children:"No conversations yet."}):v.map(e=>t.jsx(p,{userId:e.user_id,fullName:e.full_name,lastMessage:e.last_message,unread:e.unread,isSelected:j===e.user_id,onClick:Y},e.user_id))})]}),t.jsx("div",{className:`w-full md:w-2/3 lg:w-3/4 flex flex-col ${j?"flex":"hidden md:flex"}`,children:j?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"p-4 border-b border-gray-800 flex items-center justify-between bg-gray-900/50",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[t.jsx("button",{onClick:()=>_(null),className:"md:hidden text-gray-400 hover:text-white",children:t.jsx(d.Z,{size:24})}),t.jsx(l.default,{href:`/user/${j}`,children:t.jsx(f.Z,{seed:j,className:"w-10 h-10 cursor-pointer hover:opacity-80 transition"})}),t.jsx(l.default,{href:`/user/${j}`,className:"hover:underline",children:t.jsx("h2",{className:"font-bold text-lg",children:B?.full_name||"Chat"})})]}),t.jsx("button",{onClick:()=>T(!0),className:"text-gray-400 hover:text-red-400 transition p-2",title:"Report User",children:t.jsx(c.Z,{size:20})})]}),(0,t.jsxs)("div",{ref:F,onScroll:()=>{if(F.current){let{scrollTop:e,scrollHeight:r}=F.current;0===e&&$&&!Z&&(G.current=r,O(e=>e+1)),D.current=e+F.current.clientHeight<r-50}},className:"flex-grow overflow-y-auto p-4 space-y-4 bg-black",children:[Z&&t.jsx("div",{className:"flex justify-center py-2",children:t.jsx(u.Z,{className:"animate-spin text-indigo-500"})}),w.map((e,r)=>{let s=e.sender_id===i?.id,a=!s&&(0===r||w[r-1].sender_id!==e.sender_id);return t.jsx(h,{content:e.content,createdAt:e.created_at,isMe:s,showAvatar:a,senderId:e.sender_id},e.id)}),S&&t.jsx("div",{className:"flex justify-center items-center h-full",children:t.jsx(u.Z,{className:"animate-spin text-indigo-500 w-8 h-8"})})]}),A||R?t.jsx("div",{className:"p-4 border-t border-gray-800 bg-gray-900/50 text-center text-gray-400",children:A?(0,t.jsxs)("p",{className:"flex items-center justify-center gap-2",children:[t.jsx(m.Z,{size:18}),"You have blocked this user. You cannot send messages."]}):(0,t.jsxs)("p",{className:"flex items-center justify-center gap-2",children:[t.jsx(m.Z,{size:18}),"You cannot send messages to this user."]})}):t.jsx("form",{onSubmit:V,className:"p-4 border-t border-gray-800 bg-gray-900/50",children:(0,t.jsxs)("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:k,onChange:e=>P(e.target.value),placeholder:"Type a message...",className:"flex-grow bg-gray-800 border border-gray-700 rounded-full px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500"}),t.jsx("button",{type:"submit",disabled:!k.trim(),className:"bg-indigo-600 hover:bg-indigo-500 text-white p-2 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition",children:t.jsx(g,{size:20})})]})}),i&&j&&t.jsx(x.Z,{isOpen:I,onClose:()=>T(!1),reporterId:i.id,reportedUserId:j,reportedUserName:B?.full_name||"User"})]}):(0,t.jsxs)("div",{className:"flex-grow flex flex-col items-center justify-center text-gray-500",children:[t.jsx("div",{className:"bg-gray-900 p-6 rounded-full mb-4",children:t.jsx(g,{size:48,className:"text-gray-700"})}),t.jsx("p",{className:"text-xl font-medium",children:"Select a conversation to start chatting"})]})})]})}},5893:(e,r,s)=>{"use strict";let t,a;s.d(r,{z:()=>m});var i=s(326),n=s(7577),l=s.n(n);let o=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,d=function(){for(var e,r,s=0,t="",a=arguments.length;s<a;s++)(e=arguments[s])&&(r=function e(r){var s,t,a="";if("string"==typeof r||"number"==typeof r)a+=r;else if("object"==typeof r){if(Array.isArray(r)){var i=r.length;for(s=0;s<i;s++)r[s]&&(t=e(r[s]))&&(a&&(a+=" "),a+=t)}else for(t in r)r[t]&&(a&&(a+=" "),a+=t)}return a}(e))&&(t&&(t+=" "),t+=r);return t};var c=s(7506);let u=(t="w-full flex items-center justify-center px-6 py-3 font-semibold rounded-lg shadow-lg hover:shadow-2xl transform hover:scale-105 transition-all duration-300 disabled:opacity-70 disabled:cursor-not-allowed",a={variants:{variant:{primary:"bg-primary text-white hover:bg-opacity-90",secondary:"bg-secondary text-white hover:bg-opacity-90",outline:"bg-transparent border border-text-tertiary text-text-secondary hover:bg-background-secondary",danger:"bg-red-600 text-white hover:bg-red-700"}},defaultVariants:{variant:"primary"}},e=>{var r;if((null==a?void 0:a.variants)==null)return d(t,null==e?void 0:e.class,null==e?void 0:e.className);let{variants:s,defaultVariants:i}=a,n=Object.keys(s).map(r=>{let t=null==e?void 0:e[r],a=null==i?void 0:i[r];if(null===t)return null;let n=o(t)||o(a);return s[r][n]}),l=e&&Object.entries(e).reduce((e,r)=>{let[s,t]=r;return void 0===t||(e[s]=t),e},{});return d(t,n,null==a?void 0:null===(r=a.compoundVariants)||void 0===r?void 0:r.reduce((e,r)=>{let{class:s,className:t,...a}=r;return Object.entries(a).every(e=>{let[r,s]=e;return Array.isArray(s)?s.includes({...i,...l}[r]):({...i,...l})[r]===s})?[...e,s,t]:e},[]),null==e?void 0:e.class,null==e?void 0:e.className)}),m=l().forwardRef(({className:e,variant:r,isLoading:s,icon:t,children:a,...n},l)=>i.jsx("button",{className:u({variant:r,className:e}),ref:l,disabled:s,...n,children:s?(0,i.jsxs)(i.Fragment,{children:[i.jsx(c.Z,{className:"animate-spin -ml-1 mr-3 h-5 w-5"}),i.jsx("span",{children:"Loading..."})]}):(0,i.jsxs)(i.Fragment,{children:[t&&i.jsx("span",{className:"mr-2",children:t}),a]})}));m.displayName="Button"},3058:(e,r,s)=>{"use strict";s.d(r,{Z:()=>o});var t=s(326),a=s(7577),i=s(5047),n=s(373),l=s(7506);let o=({children:e})=>{let[r,s]=(0,a.useState)(!0),[o,d]=(0,a.useState)(null),[c,u]=(0,a.useState)(!1);(0,i.useRouter)();let m=(0,i.usePathname)();return((0,a.useEffect)(()=>{(async()=>{let{data:{session:e}}=await n.O.auth.getSession();if(d(e),e?.user){let{data:r,error:s}=await n.O.from("profiles").select(`
                        first_name,
                        last_name,
                        about_me,
                        age,
                        gender,
                        location_id,
                        passions_count: profile_passions(count),
                        languages_count: profile_languages(count)
                    `).eq("id",e.user.id).single();s?(console.error("Error checking profile status:",s),u(!1)):u(!!(r.first_name&&r.last_name&&r.age&&r.gender&&r.location_id&&r.passions_count?.[0]?.count>0&&r.languages_count?.[0]?.count>0))}s(!1)})()},[]),r)?t.jsx("div",{className:"flex items-center justify-center min-h-screen bg-black",children:t.jsx(l.Z,{className:"w-12 h-12 text-indigo-500 animate-spin"})}):o&&(c||"/onboarding"===m)&&(!c||"/onboarding"!==m)?t.jsx(t.Fragment,{children:e}):null}},7437:(e,r,s)=>{"use strict";s.d(r,{Z:()=>d});var t=s(326),a=s(7577),i=s(7687),n=s(5893),l=s(373),o=s(381);let d=({isOpen:e,onClose:r,reporterId:s,reportedUserId:d,reportedUserName:c})=>{let[u,m]=(0,a.useState)(""),[g,f]=(0,a.useState)(!1),x=async()=>{if(u.trim()){f(!0);try{let{error:e}=await l.O.from("reports").insert({reporter_id:s,reported_user_id:d,reason:u});if(e)throw e;o.ZP.success("Report submitted. Thank you for keeping our community safe."),m(""),r()}catch(e){console.error("Error submitting report:",e),o.ZP.error(e.message||"Failed to submit report")}finally{f(!1)}}};return t.jsx(i.Z,{isOpen:e,onClose:r,title:`Report ${c}`,children:(0,t.jsxs)("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-gray-300",children:"Please describe why you are reporting this user. This will be reviewed by our team."}),(0,t.jsxs)("div",{children:[t.jsx("label",{htmlFor:"report-reason",className:"sr-only",children:"Reason for reporting"}),t.jsx("textarea",{id:"report-reason",className:"w-full h-32 bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none",placeholder:"Reason for reporting...",value:u,onChange:e=>m(e.target.value)})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-3",children:[t.jsx(n.z,{variant:"secondary",onClick:r,className:"!w-auto",children:"Cancel"}),t.jsx(n.z,{variant:"primary",onClick:x,disabled:!u.trim()||g,isLoading:g,className:"!w-auto",children:"Submit Report"})]})]})})}},9909:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>t});let t=(0,s(8570).createProxy)(String.raw`C:\Users\wcatalfamo\Projects\Personal\skillogue-web\src\app\messages\layout.tsx#default`)},8501:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>t});let t=(0,s(8570).createProxy)(String.raw`C:\Users\wcatalfamo\Projects\Personal\skillogue-web\src\app\messages\page.tsx#default`)}};var r=require("../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[377,56],()=>s(1440));module.exports=t})();