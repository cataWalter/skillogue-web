(()=>{var e={};e.id=750,e.ids=[750],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11440:(e,s,r)=>{"use strict";r.r(s),r.d(s,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>x,tree:()=>d}),r(8501),r(79909),r(92195),r(39252),r(7629),r(27683);var t=r(23191),a=r(88716),l=r(37922),i=r.n(l),n=r(95231),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);r.d(s,o);let d=["",{children:["messages",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,8501)),"C:\\Users\\wcatalfamo\\Projects\\Personal\\skillogue-web\\src\\app\\messages\\page.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,79909)),"C:\\Users\\wcatalfamo\\Projects\\Personal\\skillogue-web\\src\\app\\messages\\layout.tsx"],loading:[()=>Promise.resolve().then(r.bind(r,92195)),"C:\\Users\\wcatalfamo\\Projects\\Personal\\skillogue-web\\src\\app\\messages\\loading.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,39252)),"C:\\Users\\wcatalfamo\\Projects\\Personal\\skillogue-web\\src\\app\\layout.tsx"],error:[()=>Promise.resolve().then(r.bind(r,7629)),"C:\\Users\\wcatalfamo\\Projects\\Personal\\skillogue-web\\src\\app\\error.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,27683)),"C:\\Users\\wcatalfamo\\Projects\\Personal\\skillogue-web\\src\\app\\not-found.tsx"]}],c=["C:\\Users\\wcatalfamo\\Projects\\Personal\\skillogue-web\\src\\app\\messages\\page.tsx"],u="/messages/page",m={require:r,loadChunk:()=>Promise.resolve()},x=new t.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/messages/page",pathname:"/messages",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},36873:(e,s,r)=>{Promise.resolve().then(r.bind(r,1219))},61869:(e,s,r)=>{Promise.resolve().then(r.bind(r,75596))},35303:()=>{},86333:(e,s,r)=>{"use strict";r.d(s,{Z:()=>t});let t=(0,r(62881).Z)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},82200:(e,s,r)=>{"use strict";r.d(s,{Z:()=>t});let t=(0,r(62881).Z)("flag",[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]])},15601:(e,s,r)=>{"use strict";r.d(s,{Z:()=>t});let t=(0,r(62881).Z)("shield-alert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]])},1219:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>l});var t=r(10326),a=r(43058);function l({children:e}){return t.jsx(a.Z,{children:e})}},75596:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>y});var t=r(10326),a=r(17577),l=r.n(a),i=r(10373),n=r(90434),o=r(35047),d=r(40617),c=r(86333),u=r(82200),m=r(77506),x=r(15601);let g=(0,r(62881).Z)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var f=r(1189),h=r(27437);let p=l().memo(({userId:e,fullName:s,lastMessage:r,unread:a,isSelected:l,onClick:i})=>t.jsx("div",{onClick:()=>i(e),className:`p-4 border-b border-gray-800 cursor-pointer hover:bg-gray-900 transition ${l?"bg-gray-900":""}`,children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[t.jsx(f.Z,{seed:e,className:"w-12 h-12"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex justify-between items-baseline",children:[t.jsx("h3",{className:"font-semibold truncate",children:s}),a>0&&t.jsx("span",{className:"bg-indigo-600 text-xs px-2 py-0.5 rounded-full",children:a})]}),t.jsx("p",{className:`text-sm truncate ${a>0?"text-white font-medium":"text-gray-400"}`,children:r})]})]})}));p.displayName="ConversationItem";let b=l().memo(({content:e,createdAt:s,isMe:r,showAvatar:a,senderId:l})=>(0,t.jsxs)("div",{className:`flex ${r?"justify-end":"justify-start"} mb-2`,children:[!r&&t.jsx("div",{className:"w-8 mr-2 flex-shrink-0",children:a&&t.jsx(f.Z,{seed:l,className:"w-8 h-8"})}),(0,t.jsxs)("div",{className:`max-w-[70%] px-4 py-2 rounded-2xl ${r?"bg-indigo-600 text-white rounded-br-none":"bg-gray-800 text-gray-200 rounded-bl-none"}`,children:[t.jsx("p",{children:e}),t.jsx("p",{className:`text-[10px] mt-1 ${r?"text-indigo-200":"text-gray-500"} text-right`,children:new Date(s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]}));b.displayName="MessageItem";let y=()=>{let e=(0,o.useSearchParams)(),s=e?.get("conversation"),r=(0,o.useRouter)(),[l,y]=(0,a.useState)(null),[j,v]=(0,a.useState)([]),[w,_]=(0,a.useState)(s||null),[N,k]=(0,a.useState)([]),[P,C]=(0,a.useState)(""),[S,Z]=(0,a.useState)(!1),[E,q]=(0,a.useState)(!1),[$,O]=(0,a.useState)(1),[R,z]=(0,a.useState)(!0),[U,M]=(0,a.useState)(!1),[I,T]=(0,a.useState)(!1),[A,F]=(0,a.useState)(!1),L=(0,a.useRef)(null),D=(0,a.useRef)(!1),G=(0,a.useRef)(!1),H=(0,a.useRef)(null);(0,a.useEffect)(()=>{(async()=>{let{data:e}=await i.O.auth.getUser();e?.user?y(e.user):r.push("/login")})()},[r]),(0,a.useEffect)(()=>{s&&_(s)},[s]);let Y=(0,a.useCallback)(async()=>{if(!l)return;let{data:e,error:s}=await i.O.rpc("get_conversations",{current_user_id:l.id});s?console.error("Error loading conversations:",s):v(e||[])},[l]),V=(0,a.useCallback)(async()=>{if(!w||!l)return;let{error:e}=await i.O.rpc("mark_messages_as_read",{sender_id_param:w,receiver_id_param:l.id});e?console.error("Error marking messages as read:",e):Y()},[w,l,Y]);(0,a.useEffect)(()=>{if(l){Y();let e=i.O.channel("conversations_update").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`receiver_id=eq.${l.id}`},()=>{Y()}).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`sender_id=eq.${l.id}`},()=>{Y()}).subscribe();return()=>{i.O.removeChannel(e)}}},[l,Y]),(0,a.useEffect)(()=>{V()},[V]),(0,a.useEffect)(()=>{(async()=>{if(!w||!l||G.current)return;G.current=!0,1===$?Z(!0):q(!0);let e=($-1)*25,{data:s,error:r}=await i.O.from("messages").select(`
                    id,
                    created_at,
                    sender_id,
                    receiver_id,
                    content,
                    sender:profiles!sender_id(id, first_name, last_name),
                    receiver:profiles!receiver_id(id, first_name, last_name)
                `).or(`and(sender_id.eq.${l.id},receiver_id.eq.${w}),and(sender_id.eq.${w},receiver_id.eq.${l.id})`).order("created_at",{ascending:!1}).range(e,e+25-1);r?console.error("Error loading messages:",r):(1===$?k(s.reverse()):k(e=>[...s.reverse(),...e]),z(25===s.length)),Z(!1),q(!1),G.current=!1})()},[w,l,$]),(0,a.useEffect)(()=>{(async()=>{if(!l||!w)return;let{data:e}=await i.O.from("blocks").select("*").eq("blocker_id",l.id).eq("blocked_id",w).single();T(!!e);let{data:s}=await i.O.from("blocks").select("*").eq("blocker_id",w).eq("blocked_id",l.id).single();M(!!s)})()},[l,w]),(0,a.useEffect)(()=>{if(!w||!l)return;let e=i.O.channel(`chat:${w}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`receiver_id=eq.${l.id}`},e=>{e.new.sender_id===w&&i.O.from("messages").select(`
                            id,
                            created_at,
                            sender_id,
                            receiver_id,
                            content,
                            sender:profiles!sender_id(id, first_name, last_name),
                            receiver:profiles!receiver_id(id, first_name, last_name)
                        `).eq("id",e.new.id).single().then(({data:e})=>{e&&(k(s=>[...s,e]),V())})}).subscribe();return()=>{i.O.removeChannel(e)}},[w,l,V]),(0,a.useLayoutEffect)(()=>{if(L.current){if(1!==$||D.current){if(H.current){let e=L.current.scrollHeight;L.current.scrollTop=e-H.current}}else L.current.scrollTop=L.current.scrollHeight}},[N,$]);let X=async e=>{if(e.preventDefault(),!P.trim()||!w||!l)return;let s=P.trim();C("");let r=Date.now(),t={id:r,created_at:new Date().toISOString(),sender_id:l.id,receiver_id:w,content:s,sender:{id:l.id,first_name:"You",last_name:""},receiver:{id:w,first_name:"",last_name:""}};k(e=>[...e,t]);let{error:a}=await i.O.from("messages").insert({sender_id:l.id,receiver_id:w,content:s});a?(console.error("Error sending message:",a),k(e=>e.filter(e=>e.id!==r)),alert("Failed to send message")):Y()},B=(0,a.useCallback)(e=>{_(e),O(1),k([]),z(!0),D.current=!1,r.push(`/messages?conversation=${e}`)},[r]),J=j.find(e=>e.user_id===w);return(0,t.jsxs)("div",{className:"flex h-[calc(100vh-64px)] bg-black text-white",children:[(0,t.jsxs)("div",{className:`w-full md:w-1/3 lg:w-1/4 border-r border-gray-800 flex flex-col ${w?"hidden md:flex":"flex"}`,children:[t.jsx("div",{className:"p-4 border-b border-gray-800",children:t.jsx("h2",{className:"text-xl font-bold",children:"Messages"})}),t.jsx("div",{className:"flex-grow overflow-y-auto",children:0===j.length?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 p-6 text-center text-gray-400",children:[t.jsx(d.Z,{className:"w-12 h-12 mb-4 text-gray-600"}),t.jsx("p",{className:"text-lg font-medium text-white",children:"No conversations yet"}),t.jsx("p",{className:"text-sm mt-2",children:"Start connecting with people who share your passions!"}),t.jsx(n.default,{href:"/search",className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-500 transition",children:"Find People"})]}):j.map(e=>t.jsx(p,{userId:e.user_id,fullName:e.full_name,lastMessage:e.last_message,unread:e.unread,isSelected:w===e.user_id,onClick:B},e.user_id))})]}),t.jsx("div",{className:`w-full md:w-2/3 lg:w-3/4 flex flex-col ${w?"flex":"hidden md:flex"}`,children:w?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"p-4 border-b border-gray-800 flex items-center justify-between bg-gray-900/50",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[t.jsx("button",{onClick:()=>_(null),className:"md:hidden text-gray-400 hover:text-white",children:t.jsx(c.Z,{size:24})}),t.jsx(n.default,{href:`/user/${w}`,children:t.jsx(f.Z,{seed:w,className:"w-10 h-10 cursor-pointer hover:opacity-80 transition"})}),t.jsx(n.default,{href:`/user/${w}`,className:"hover:underline",children:t.jsx("h2",{className:"font-bold text-lg",children:J?.full_name||"Chat"})})]}),t.jsx("button",{onClick:()=>F(!0),className:"text-gray-400 hover:text-red-400 transition p-2",title:"Report User",children:t.jsx(u.Z,{size:20})})]}),(0,t.jsxs)("div",{ref:L,onScroll:()=>{if(L.current){let{scrollTop:e,scrollHeight:s}=L.current;0===e&&R&&!E&&(H.current=s,O(e=>e+1)),D.current=e+L.current.clientHeight<s-50}},className:"flex-grow overflow-y-auto p-4 space-y-4 bg-black",children:[E&&t.jsx("div",{className:"flex justify-center py-2",children:t.jsx(m.Z,{className:"animate-spin text-indigo-500"})}),N.map((e,s)=>{let r=e.sender_id===l?.id,a=!r&&(0===s||N[s-1].sender_id!==e.sender_id);return t.jsx(b,{content:e.content,createdAt:e.created_at,isMe:r,showAvatar:a,senderId:e.sender_id},e.id)}),S&&t.jsx("div",{className:"flex justify-center items-center h-full",children:t.jsx(m.Z,{className:"animate-spin text-indigo-500 w-8 h-8"})})]}),I||U?t.jsx("div",{className:"p-4 border-t border-gray-800 bg-gray-900/50 text-center text-gray-400",children:I?(0,t.jsxs)("p",{className:"flex items-center justify-center gap-2",children:[t.jsx(x.Z,{size:18}),"You have blocked this user. You cannot send messages."]}):(0,t.jsxs)("p",{className:"flex items-center justify-center gap-2",children:[t.jsx(x.Z,{size:18}),"You cannot send messages to this user."]})}):t.jsx("form",{onSubmit:X,className:"p-4 border-t border-gray-800 bg-gray-900/50",children:(0,t.jsxs)("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:P,onChange:e=>C(e.target.value),placeholder:"Type a message...",className:"flex-grow bg-gray-800 border border-gray-700 rounded-full px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500"}),t.jsx("button",{type:"submit",disabled:!P.trim(),className:"bg-indigo-600 hover:bg-indigo-500 text-white p-2 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition",children:t.jsx(g,{size:20})})]})}),l&&w&&t.jsx(h.Z,{isOpen:A,onClose:()=>F(!1),reporterId:l.id,reportedUserId:w,reportedUserName:J?.full_name||"User"})]}):(0,t.jsxs)("div",{className:"flex-grow flex flex-col items-center justify-center text-gray-500",children:[t.jsx("div",{className:"bg-gray-900 p-6 rounded-full mb-4",children:t.jsx(g,{size:48,className:"text-gray-700"})}),t.jsx("p",{className:"text-xl font-medium",children:"Select a conversation to start chatting"})]})})]})}},37687:(e,s,r)=>{"use strict";r.d(s,{Z:()=>n});var t=r(10326),a=r(17577),l=r(60962),i=r(94019);let n=({isOpen:e,onClose:s,title:r,children:n,footer:o})=>{let d=(0,a.useRef)(null),[c,u]=(0,a.useState)(!1);if((0,a.useEffect)(()=>(u(!0),()=>u(!1)),[]),(0,a.useEffect)(()=>{let r=e=>{"Escape"===e.key&&s()};return e&&(document.addEventListener("keydown",r),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",r),document.body.style.overflow="unset"}},[e,s]),!e||!c)return null;let m=t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm transition-opacity",onClick:e=>{d.current&&!d.current.contains(e.target)&&s()},role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:(0,t.jsxs)("div",{ref:d,className:"bg-gray-900 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-gray-800 animate-in fade-in zoom-in duration-200",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center p-6 border-b border-gray-800 sticky top-0 bg-gray-900 z-10",children:[t.jsx("h2",{id:"modal-title",className:"text-xl font-bold text-white",children:r}),t.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white p-1 rounded-full hover:bg-gray-800 transition","aria-label":"Close modal",children:t.jsx(i.Z,{size:24})})]}),t.jsx("div",{className:"p-6 text-gray-300",children:n}),o&&t.jsx("div",{className:"flex justify-end p-6 border-t border-gray-800 bg-gray-900 sticky bottom-0 z-10",children:o})]})});return(0,l.createPortal)(m,document.body)}},43058:(e,s,r)=>{"use strict";r.d(s,{Z:()=>o});var t=r(10326),a=r(17577),l=r(35047),i=r(10373),n=r(77506);let o=({children:e})=>{let[s,r]=(0,a.useState)(!0),[o,d]=(0,a.useState)(null),[c,u]=(0,a.useState)(!1);(0,l.useRouter)();let m=(0,l.usePathname)();return((0,a.useEffect)(()=>{(async()=>{let{data:{session:e}}=await i.O.auth.getSession();if(d(e),e?.user){let{data:s,error:r}=await i.O.from("profiles").select(`
                        first_name,
                        last_name,
                        about_me,
                        age,
                        gender,
                        location_id,
                        passions_count: profile_passions(count),
                        languages_count: profile_languages(count)
                    `).eq("id",e.user.id).single();r?(console.error("Error checking profile status:",r),u(!1)):u(!!(s.first_name&&s.last_name&&s.age&&s.gender&&s.location_id&&s.passions_count?.[0]?.count>0&&s.languages_count?.[0]?.count>0))}r(!1)})()},[]),s)?t.jsx("div",{className:"flex items-center justify-center min-h-screen bg-black",children:t.jsx(n.Z,{className:"w-12 h-12 text-indigo-500 animate-spin"})}):o&&(c||"/onboarding"===m)&&(!c||"/onboarding"!==m)?t.jsx(t.Fragment,{children:e}):null}},27437:(e,s,r)=>{"use strict";r.d(s,{Z:()=>d});var t=r(10326),a=r(17577),l=r(37687),i=r(48648),n=r(10373),o=r(40381);let d=({isOpen:e,onClose:s,reporterId:r,reportedUserId:d,reportedUserName:c})=>{let[u,m]=(0,a.useState)(""),[x,g]=(0,a.useState)(!1),f=async()=>{if(u.trim()){g(!0);try{let{error:e}=await n.O.from("reports").insert({reporter_id:r,reported_user_id:d,reason:u});if(e)throw e;o.ZP.success("Report submitted. Thank you for keeping our community safe."),m(""),s()}catch(s){console.error("Error submitting report:",s);let e=s instanceof Error?s.message:"Failed to submit report";o.ZP.error(e)}finally{g(!1)}}};return t.jsx(l.Z,{isOpen:e,onClose:s,title:`Report ${c}`,children:(0,t.jsxs)("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-gray-300",children:"Please describe why you are reporting this user. This will be reviewed by our team."}),(0,t.jsxs)("div",{children:[t.jsx("label",{htmlFor:"report-reason",className:"sr-only",children:"Reason for reporting"}),t.jsx("textarea",{id:"report-reason",className:"w-full h-32 bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none",placeholder:"Reason for reporting...",value:u,onChange:e=>m(e.target.value)})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-3",children:[t.jsx(i.z,{variant:"secondary",onClick:s,className:"!w-auto",children:"Cancel"}),t.jsx(i.z,{variant:"primary",onClick:f,disabled:!u.trim()||x,isLoading:x,className:"!w-auto",children:"Submit Report"})]})]})})}},79909:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>t});let t=(0,r(68570).createProxy)(String.raw`C:\Users\wcatalfamo\Projects\Personal\skillogue-web\src\app\messages\layout.tsx#default`)},92195:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>l});var t=r(19510),a=r(37280);function l(){return(0,t.jsxs)("div",{className:"flex h-[calc(100vh-64px)]",children:[(0,t.jsxs)("div",{className:"w-full md:w-1/3 lg:w-1/4 border-r border-gray-800 p-4 hidden md:block",children:[t.jsx(a.Z,{className:"h-10 w-full mb-6"}),t.jsx("div",{className:"space-y-4",children:[1,2,3,4,5].map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[t.jsx(a.Z,{className:"w-12 h-12 rounded-full"}),(0,t.jsxs)("div",{className:"flex-1",children:[t.jsx(a.Z,{className:"h-4 w-3/4 mb-2"}),t.jsx(a.Z,{className:"h-3 w-1/2"})]})]},e))})]}),(0,t.jsxs)("div",{className:"flex-1 p-4 flex flex-col",children:[t.jsx("div",{className:"flex-1 space-y-6 p-4",children:[1,2,3].map(e=>t.jsx("div",{className:`flex ${e%2==0?"justify-end":"justify-start"}`,children:t.jsx(a.Z,{className:"h-16 w-1/2 rounded-2xl"})},e))}),t.jsx(a.Z,{className:"h-14 w-full rounded-lg mt-4"})]})]})}},8501:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>t});let t=(0,r(68570).createProxy)(String.raw`C:\Users\wcatalfamo\Projects\Personal\skillogue-web\src\app\messages\page.tsx#default`)},37280:(e,s,r)=>{"use strict";r.d(s,{Z:()=>a});var t=r(19510);r(71159);let a=({className:e})=>t.jsx("div",{className:`animate-pulse bg-gray-800 rounded ${e}`})}};var s=require("../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[880,383],()=>r(11440));module.exports=t})();