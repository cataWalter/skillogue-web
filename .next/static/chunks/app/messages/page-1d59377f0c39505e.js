(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[750],{3326:function(e,r,t){Promise.resolve().then(t.bind(t,4993))},2660:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});let s=(0,t(9205).Z)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},6211:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});let s=(0,t(9205).Z)("flag",[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]])},1817:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});let s=(0,t(9205).Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},3578:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});let s=(0,t(9205).Z)("shield-alert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]])},2489:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});let s=(0,t(9205).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},9376:function(e,r,t){"use strict";var s=t(5475);t.o(s,"useParams")&&t.d(r,{useParams:function(){return s.useParams}}),t.o(s,"usePathname")&&t.d(r,{usePathname:function(){return s.usePathname}}),t.o(s,"useRouter")&&t.d(r,{useRouter:function(){return s.useRouter}}),t.o(s,"useSearchParams")&&t.d(r,{useSearchParams:function(){return s.useSearchParams}})},4993:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return b}});var s=t(7437),a=t(2265),n=t(7905),i=t(7648),l=t(9376),d=t(2660),c=t(6211),o=t(1817),u=t(3578);let f=(0,t(9205).Z)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var m=t(3764),x=t(8651);let h=a.memo(e=>{let{userId:r,fullName:t,lastMessage:a,unread:n,isSelected:i,onClick:l}=e;return(0,s.jsx)("div",{onClick:()=>l(r),className:"p-4 border-b border-gray-800 cursor-pointer hover:bg-gray-900 transition ".concat(i?"bg-gray-900":""),children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(m.Z,{seed:r,className:"w-12 h-12"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex justify-between items-baseline",children:[(0,s.jsx)("h3",{className:"font-semibold truncate",children:t}),n>0&&(0,s.jsx)("span",{className:"bg-indigo-600 text-xs px-2 py-0.5 rounded-full",children:n})]}),(0,s.jsx)("p",{className:"text-sm truncate ".concat(n>0?"text-white font-medium":"text-gray-400"),children:a})]})]})})});h.displayName="ConversationItem";let g=a.memo(e=>{let{content:r,createdAt:t,isMe:a,showAvatar:n,senderId:i}=e;return(0,s.jsxs)("div",{className:"flex ".concat(a?"justify-end":"justify-start"," mb-2"),children:[!a&&(0,s.jsx)("div",{className:"w-8 mr-2 flex-shrink-0",children:n&&(0,s.jsx)(m.Z,{seed:i,className:"w-8 h-8"})}),(0,s.jsxs)("div",{className:"max-w-[70%] px-4 py-2 rounded-2xl ".concat(a?"bg-indigo-600 text-white rounded-br-none":"bg-gray-800 text-gray-200 rounded-bl-none"),children:[(0,s.jsx)("p",{children:r}),(0,s.jsx)("p",{className:"text-[10px] mt-1 ".concat(a?"text-indigo-200":"text-gray-500"," text-right"),children:new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})});g.displayName="MessageItem";var b=()=>{let e=(0,l.useSearchParams)(),r=null==e?void 0:e.get("conversation"),t=(0,l.useRouter)(),[b,v]=(0,a.useState)(null),[y,p]=(0,a.useState)([]),[j,_]=(0,a.useState)(r||null),[w,N]=(0,a.useState)([]),[k,S]=(0,a.useState)(""),[Z,C]=(0,a.useState)(!1),[E,O]=(0,a.useState)(!1),[P,A]=(0,a.useState)(1),[R,z]=(0,a.useState)(!0),[M,q]=(0,a.useState)(!1),[I,U]=(0,a.useState)(!1),[T,L]=(0,a.useState)(!1),F=(0,a.useRef)(null),D=(0,a.useRef)(!1),Y=(0,a.useRef)(null);(0,a.useEffect)(()=>{(async()=>{let{data:e}=await n.O.auth.getUser();(null==e?void 0:e.user)?v(e.user):t.push("/login")})()},[t]),(0,a.useEffect)(()=>{r&&_(r)},[r]);let H=(0,a.useCallback)(async()=>{if(!b)return;let{data:e,error:r}=await n.O.rpc("get_conversations",{current_user_id:b.id});r?console.error("Error loading conversations:",r):p(e||[])},[b]),V=(0,a.useCallback)(async()=>{if(!j||!b)return;let{error:e}=await n.O.rpc("mark_messages_as_read",{sender_id_param:j,receiver_id_param:b.id});e?console.error("Error marking messages as read:",e):H()},[j,b,H]);(0,a.useEffect)(()=>{if(b){H();let e=setInterval(H,15e3);return()=>clearInterval(e)}},[b,H]),(0,a.useEffect)(()=>{V()},[V]),(0,a.useEffect)(()=>{(async()=>{if(!j||!b||E)return;1===P?C(!0):O(!0);let e=(P-1)*25,{data:r,error:t}=await n.O.from("messages").select("\n                    id,\n                    created_at,\n                    sender_id,\n                    receiver_id,\n                    content,\n                    sender:profiles!sender_id(id, first_name, last_name),\n                    receiver:profiles!receiver_id(id, first_name, last_name)\n                ").or("and(sender_id.eq.".concat(b.id,",receiver_id.eq.").concat(j,"),and(sender_id.eq.").concat(j,",receiver_id.eq.").concat(b.id,")")).order("created_at",{ascending:!1}).range(e,e+25-1);t?console.error("Error loading messages:",t):(1===P?N(r.reverse()):N(e=>[...r.reverse(),...e]),z(25===r.length)),C(!1),O(!1)})()},[j,b,P]),(0,a.useEffect)(()=>{(async()=>{if(!b||!j)return;let{data:e}=await n.O.from("blocks").select("*").eq("blocker_id",b.id).eq("blocked_id",j).single();U(!!e);let{data:r}=await n.O.from("blocks").select("*").eq("blocker_id",j).eq("blocked_id",b.id).single();q(!!r)})()},[b,j]),(0,a.useEffect)(()=>{if(!j||!b)return;let e=n.O.channel("chat:".concat(j)).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:"receiver_id=eq.".concat(b.id)},e=>{e.new.sender_id===j&&n.O.from("messages").select("\n                            id,\n                            created_at,\n                            sender_id,\n                            receiver_id,\n                            content,\n                            sender:profiles!sender_id(id, first_name, last_name),\n                            receiver:profiles!receiver_id(id, first_name, last_name)\n                        ").eq("id",e.new.id).single().then(e=>{let{data:r}=e;r&&(N(e=>[...e,r]),V())})}).subscribe();return()=>{n.O.removeChannel(e)}},[j,b,V]),(0,a.useLayoutEffect)(()=>{if(F.current){if(1!==P||D.current){if(Y.current){let e=F.current.scrollHeight;F.current.scrollTop=e-Y.current}}else F.current.scrollTop=F.current.scrollHeight}},[w,P]);let B=async e=>{if(e.preventDefault(),!k.trim()||!j||!b)return;let r=k.trim();S("");let t=Date.now(),s={id:t,created_at:new Date().toISOString(),sender_id:b.id,receiver_id:j,content:r,sender:{id:b.id,first_name:"You",last_name:""},receiver:{id:j,first_name:"",last_name:""}};N(e=>[...e,s]);let{error:a}=await n.O.from("messages").insert({sender_id:b.id,receiver_id:j,content:r});a?(console.error("Error sending message:",a),N(e=>e.filter(e=>e.id!==t)),alert("Failed to send message")):H()},$=(0,a.useCallback)(e=>{_(e),A(1),N([]),z(!0),D.current=!1,t.push("/messages?conversation=".concat(e))},[t]),K=y.find(e=>e.user_id===j);return(0,s.jsxs)("div",{className:"flex h-[calc(100vh-64px)] bg-black text-white",children:[(0,s.jsxs)("div",{className:"w-full md:w-1/3 lg:w-1/4 border-r border-gray-800 flex flex-col ".concat(j?"hidden md:flex":"flex"),children:[(0,s.jsx)("div",{className:"p-4 border-b border-gray-800",children:(0,s.jsx)("h2",{className:"text-xl font-bold",children:"Messages"})}),(0,s.jsx)("div",{className:"flex-grow overflow-y-auto",children:0===y.length?(0,s.jsx)("div",{className:"p-4 text-gray-400 text-center",children:"No conversations yet."}):y.map(e=>(0,s.jsx)(h,{userId:e.user_id,fullName:e.full_name,lastMessage:e.last_message,unread:e.unread,isSelected:j===e.user_id,onClick:$},e.user_id))})]}),(0,s.jsx)("div",{className:"w-full md:w-2/3 lg:w-3/4 flex flex-col ".concat(j?"flex":"hidden md:flex"),children:j?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"p-4 border-b border-gray-800 flex items-center justify-between bg-gray-900/50",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("button",{onClick:()=>_(null),className:"md:hidden text-gray-400 hover:text-white",children:(0,s.jsx)(d.Z,{size:24})}),(0,s.jsx)(i.default,{href:"/user/".concat(j),children:(0,s.jsx)(m.Z,{seed:j,className:"w-10 h-10 cursor-pointer hover:opacity-80 transition"})}),(0,s.jsx)(i.default,{href:"/user/".concat(j),className:"hover:underline",children:(0,s.jsx)("h2",{className:"font-bold text-lg",children:(null==K?void 0:K.full_name)||"Chat"})})]}),(0,s.jsx)("button",{onClick:()=>L(!0),className:"text-gray-400 hover:text-red-400 transition p-2",title:"Report User",children:(0,s.jsx)(c.Z,{size:20})})]}),(0,s.jsxs)("div",{ref:F,onScroll:()=>{if(F.current){let{scrollTop:e,scrollHeight:r}=F.current;0===e&&R&&!E&&(Y.current=r,A(e=>e+1)),D.current=e+F.current.clientHeight<r-50}},className:"flex-grow overflow-y-auto p-4 space-y-4 bg-black",children:[E&&(0,s.jsx)("div",{className:"flex justify-center py-2",children:(0,s.jsx)(o.Z,{className:"animate-spin text-indigo-500"})}),w.map((e,r)=>{let t=e.sender_id===(null==b?void 0:b.id),a=!t&&(0===r||w[r-1].sender_id!==e.sender_id);return(0,s.jsx)(g,{content:e.content,createdAt:e.created_at,isMe:t,showAvatar:a,senderId:e.sender_id},e.id)}),Z&&(0,s.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,s.jsx)(o.Z,{className:"animate-spin text-indigo-500 w-8 h-8"})})]}),I||M?(0,s.jsx)("div",{className:"p-4 border-t border-gray-800 bg-gray-900/50 text-center text-gray-400",children:I?(0,s.jsxs)("p",{className:"flex items-center justify-center gap-2",children:[(0,s.jsx)(u.Z,{size:18}),"You have blocked this user. You cannot send messages."]}):(0,s.jsxs)("p",{className:"flex items-center justify-center gap-2",children:[(0,s.jsx)(u.Z,{size:18}),"You cannot send messages to this user."]})}):(0,s.jsx)("form",{onSubmit:B,className:"p-4 border-t border-gray-800 bg-gray-900/50",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{type:"text",value:k,onChange:e=>S(e.target.value),placeholder:"Type a message...",className:"flex-grow bg-gray-800 border border-gray-700 rounded-full px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500"}),(0,s.jsx)("button",{type:"submit",disabled:!k.trim(),className:"bg-indigo-600 hover:bg-indigo-500 text-white p-2 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition",children:(0,s.jsx)(f,{size:20})})]})}),b&&j&&(0,s.jsx)(x.Z,{isOpen:T,onClose:()=>L(!1),reporterId:b.id,reportedUserId:j,reportedUserName:(null==K?void 0:K.full_name)||"User"})]}):(0,s.jsxs)("div",{className:"flex-grow flex flex-col items-center justify-center text-gray-500",children:[(0,s.jsx)("div",{className:"bg-gray-900 p-6 rounded-full mb-4",children:(0,s.jsx)(f,{size:48,className:"text-gray-700"})}),(0,s.jsx)("p",{className:"text-xl font-medium",children:"Select a conversation to start chatting"})]})})]})}},3764:function(e,r,t){"use strict";var s=t(7437),a=t(2265),n=t(2523);let i=[t(5397),t(1210),t(4508),t(1241),t(336),t(9519),t(918),t(2250)];r.Z=e=>{let{seed:r,className:t,alt:l}=e,[d,c]=(0,a.useState)("");return((0,a.useEffect)(()=>{let e=e=>{let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t)|0;return Math.abs(r)},t=async()=>{let t=e(r)%i.length,s=i[t];try{let e=await (0,n.$i)(s,{seed:r,radius:50,backgroundColor:["b6e3f4","c0aede","d1d4f9","ffd5dc","ffdfbf"]}),t=await e.toDataUri();c(t)}catch(e){console.error("Failed to generate avatar:",e)}};r&&t()},[r]),d)?(0,s.jsx)("img",{src:d,alt:l||"User Avatar",className:t||"w-12 h-12 rounded-full object-cover"}):(0,s.jsx)("div",{className:t||"w-12 h-12 rounded-full bg-gray-700 animate-pulse","aria-label":"Loading avatar"})}},795:function(e,r,t){"use strict";let s,a;t.d(r,{z:function(){return u}});var n=t(7437),i=t(2265);let l=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,d=function(){for(var e,r,t=0,s="",a=arguments.length;t<a;t++)(e=arguments[t])&&(r=function e(r){var t,s,a="";if("string"==typeof r||"number"==typeof r)a+=r;else if("object"==typeof r){if(Array.isArray(r)){var n=r.length;for(t=0;t<n;t++)r[t]&&(s=e(r[t]))&&(a&&(a+=" "),a+=s)}else for(s in r)r[s]&&(a&&(a+=" "),a+=s)}return a}(e))&&(s&&(s+=" "),s+=r);return s};var c=t(1817);let o=(s="w-full flex items-center justify-center px-6 py-3 font-semibold rounded-lg shadow-lg hover:shadow-2xl transform hover:scale-105 transition-all duration-300 disabled:opacity-70 disabled:cursor-not-allowed",a={variants:{variant:{primary:"bg-primary text-white hover:bg-opacity-90",secondary:"bg-secondary text-white hover:bg-opacity-90",outline:"bg-transparent border border-text-tertiary text-text-secondary hover:bg-background-secondary",danger:"bg-red-600 text-white hover:bg-red-700"}},defaultVariants:{variant:"primary"}},e=>{var r;if((null==a?void 0:a.variants)==null)return d(s,null==e?void 0:e.class,null==e?void 0:e.className);let{variants:t,defaultVariants:n}=a,i=Object.keys(t).map(r=>{let s=null==e?void 0:e[r],a=null==n?void 0:n[r];if(null===s)return null;let i=l(s)||l(a);return t[r][i]}),c=e&&Object.entries(e).reduce((e,r)=>{let[t,s]=r;return void 0===s||(e[t]=s),e},{});return d(s,i,null==a?void 0:null===(r=a.compoundVariants)||void 0===r?void 0:r.reduce((e,r)=>{let{class:t,className:s,...a}=r;return Object.entries(a).every(e=>{let[r,t]=e;return Array.isArray(t)?t.includes({...n,...c}[r]):({...n,...c})[r]===t})?[...e,t,s]:e},[]),null==e?void 0:e.class,null==e?void 0:e.className)}),u=i.forwardRef((e,r)=>{let{className:t,variant:s,isLoading:a,icon:i,children:l,...d}=e;return(0,n.jsx)("button",{className:o({variant:s,className:t}),ref:r,disabled:a,...d,children:a?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c.Z,{className:"animate-spin -ml-1 mr-3 h-5 w-5"}),(0,n.jsx)("span",{children:"Loading..."})]}):(0,n.jsxs)(n.Fragment,{children:[i&&(0,n.jsx)("span",{className:"mr-2",children:i}),l]})})});u.displayName="Button"},6003:function(e,r,t){"use strict";var s=t(7437),a=t(2265),n=t(4887),i=t(2489);r.Z=e=>{let{isOpen:r,onClose:t,title:l,children:d,footer:c}=e,o=(0,a.useRef)(null),[u,f]=(0,a.useState)(!1);if((0,a.useEffect)(()=>(f(!0),()=>f(!1)),[]),(0,a.useEffect)(()=>{let e=e=>{"Escape"===e.key&&t()};return r&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[r,t]),!r||!u)return null;let m=(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm transition-opacity",onClick:e=>{o.current&&!o.current.contains(e.target)&&t()},role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:(0,s.jsxs)("div",{ref:o,className:"bg-gray-900 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-gray-800 animate-in fade-in zoom-in duration-200",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center p-6 border-b border-gray-800 sticky top-0 bg-gray-900 z-10",children:[(0,s.jsx)("h2",{id:"modal-title",className:"text-xl font-bold text-white",children:l}),(0,s.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-white p-1 rounded-full hover:bg-gray-800 transition","aria-label":"Close modal",children:(0,s.jsx)(i.Z,{size:24})})]}),(0,s.jsx)("div",{className:"p-6 text-gray-300",children:d}),c&&(0,s.jsx)("div",{className:"flex justify-end p-6 border-t border-gray-800 bg-gray-900 sticky bottom-0 z-10",children:c})]})});return(0,n.createPortal)(m,document.body)}},8651:function(e,r,t){"use strict";var s=t(7437),a=t(2265),n=t(6003),i=t(795),l=t(7905),d=t(9064);r.Z=e=>{let{isOpen:r,onClose:t,reporterId:c,reportedUserId:o,reportedUserName:u}=e,[f,m]=(0,a.useState)(""),[x,h]=(0,a.useState)(!1),g=async()=>{if(f.trim()){h(!0);try{let{error:e}=await l.O.from("reports").insert({reporter_id:c,reported_user_id:o,reason:f});if(e)throw e;d.ZP.success("Report submitted. Thank you for keeping our community safe."),m(""),t()}catch(e){console.error("Error submitting report:",e),d.ZP.error(e.message||"Failed to submit report")}finally{h(!1)}}};return(0,s.jsx)(n.Z,{isOpen:r,onClose:t,title:"Report ".concat(u),children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("p",{className:"text-gray-300",children:"Please describe why you are reporting this user. This will be reviewed by our team."}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"report-reason",className:"sr-only",children:"Reason for reporting"}),(0,s.jsx)("textarea",{id:"report-reason",className:"w-full h-32 bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none",placeholder:"Reason for reporting...",value:f,onChange:e=>m(e.target.value)})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,s.jsx)(i.z,{variant:"secondary",onClick:t,className:"!w-auto",children:"Cancel"}),(0,s.jsx)(i.z,{variant:"primary",onClick:g,disabled:!f.trim()||x,isLoading:x,className:"!w-auto",children:"Submit Report"})]})]})})}},7905:function(e,r,t){"use strict";t.d(r,{O:function(){return n}});var s=t(9066),a=t(257);let n=(0,s.eI)(a.env.REACT_APP_SUPABASE_URL,a.env.REACT_APP_SUPABASE_ANON_KEY)}},function(e){e.O(0,[328,647,362,779,145,64,971,117,744],function(){return e(e.s=3326)}),_N_E=e.O()}]);