(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[193],{8225:function(e,t,a){Promise.resolve().then(a.bind(a,4391))},4391:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return d}});var s=a(7437);a(2265);var r=a(7648),n=a(1082),i=a(3764),l=a(4766);let o=(0,a(9205).Z)("check-check",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);var c=a(6682),d=()=>{let{notifications:e,unreadCount:t,markAsRead:a}=(0,n.z)(),d=e=>"new_message"===e.type&&e.actor?"/messages?with=".concat(e.actor.id):"#",u=e=>{var t;let a=(null===(t=e.actor)||void 0===t?void 0:t.first_name)||"An unknown user";return"new_message"===e.type?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("strong",{children:a})," sent you a new message."]}):"You have a new notification."};return(0,s.jsxs)("main",{className:"flex-grow p-6 max-w-3xl mx-auto w-full",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,s.jsxs)("h1",{className:"text-4xl font-bold flex items-center gap-3",children:[(0,s.jsx)(l.Z,{className:"text-indigo-400"}),"Notifications"]}),t>0&&(0,s.jsxs)("button",{onClick:()=>a(null),className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm font-semibold transition",children:[(0,s.jsx)(o,{size:16}),"Mark All as Read"]})]}),(0,s.jsx)("div",{className:"bg-gray-900/70 border border-gray-800 rounded-xl shadow-lg",children:0===e.length?(0,s.jsx)("p",{className:"text-gray-400 p-12 text-center",children:"You have no notifications yet."}):(0,s.jsx)("ul",{className:"divide-y divide-gray-800",children:e.map(e=>(0,s.jsx)("li",{children:(0,s.jsxs)(r.default,{href:d(e),onClick:()=>!e.read&&a(e.id),className:"flex items-start gap-4 p-4 transition-colors duration-200 ".concat(e.read?"hover:bg-gray-800/50":"bg-indigo-900/20 hover:bg-indigo-900/40"),children:[e.actor?(0,s.jsx)(i.Z,{seed:e.actor.id,className:"w-12 h-12 rounded-full flex-shrink-0 mt-1"}):(0,s.jsx)("div",{className:"w-12 h-12 rounded-full bg-gray-700 flex-shrink-0 mt-1"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-gray-200",children:u(e)}),(0,s.jsxs)("p",{className:"text-sm text-gray-400 mt-1",children:[(0,c.Q)(new Date(e.created_at))," ago"]})]}),!e.read&&(0,s.jsx)("div",{className:"w-3 h-3 bg-indigo-500 rounded-full mt-2 flex-shrink-0",title:"Unread"})]})},e.id))})})]})}},3764:function(e,t,a){"use strict";var s=a(7437),r=a(2265),n=a(2523);let i=[a(5397),a(1210),a(4508),a(1241),a(336),a(9519),a(918),a(2250)];t.Z=e=>{let{seed:t,className:a,alt:l}=e,[o,c]=(0,r.useState)("");return((0,r.useEffect)(()=>{let e=e=>{let t=0;for(let a=0;a<e.length;a++)t=(t<<5)-t+e.charCodeAt(a)|0;return Math.abs(t)},a=async()=>{let a=e(t)%i.length,s=i[a];try{let e=await (0,n.$i)(s,{seed:t,radius:50,backgroundColor:["b6e3f4","c0aede","d1d4f9","ffd5dc","ffdfbf"]}),a=await e.toDataUri();c(a)}catch(e){console.error("Failed to generate avatar:",e)}};t&&a()},[t]),o)?(0,s.jsx)("img",{src:o,alt:l||"User Avatar",className:a||"w-12 h-12 rounded-full object-cover"}):(0,s.jsx)("div",{className:a||"w-12 h-12 rounded-full bg-gray-700 animate-pulse","aria-label":"Loading avatar"})}},1082:function(e,t,a){"use strict";a.d(t,{NotificationProvider:function(){return u},z:function(){return f}});var s=a(7437),r=a(2265),n=a(7905),i=a(9064),l=a(3417),o=a(2489),c=e=>{let{message:t,sender:a,onClose:n}=e;return(0,r.useEffect)(()=>{let e=setTimeout(()=>{n()},5e3);return()=>clearTimeout(e)},[n]),(0,s.jsxs)("div",{className:"fixed bottom-5 right-5 w-full max-w-sm bg-gray-800 border border-gray-700 rounded-lg shadow-lg text-white p-4 flex items-start gap-4 animate-fade-in-up z-50",children:[(0,s.jsx)("div",{className:"flex-shrink-0 pt-1",children:(0,s.jsx)(l.Z,{className:"h-6 w-6 text-indigo-400"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"font-semibold",children:a}),(0,s.jsx)("p",{className:"text-sm text-gray-300",children:t})]}),(0,s.jsx)("button",{onClick:n,className:"text-gray-400 hover:text-white",children:(0,s.jsx)(o.Z,{size:18})})]})};let d=(0,r.createContext)(void 0),u=e=>{let{children:t}=e,[a,l]=(0,r.useState)(null),[o,u]=(0,r.useState)([]),[f,m]=(0,r.useState)(0);(0,r.useEffect)(()=>{(async()=>{let{data:{session:e}}=await n.O.auth.getSession();l(e)})();let{data:{subscription:e}}=n.O.auth.onAuthStateChange((e,t)=>{l(t)});return()=>e.unsubscribe()},[]);let h=(0,r.useCallback)(async()=>{if(!(null==a?void 0:a.user))return;let{data:e,error:t}=await n.O.from("notifications").select("\n                id, read, type, created_at,\n                actor:actor_id (id, first_name)\n            ").eq("user_id",a.user.id).order("created_at",{ascending:!1}).limit(100);if(t){console.error("Error fetching notifications:",t);return}let s=(e||[]).map(e=>({...e,actor:Array.isArray(e.actor)?e.actor[0]||null:e.actor||null}));u(s),m(s.filter(e=>!e.read).length)},[a]);(0,r.useEffect)(()=>{a&&h()},[a,h]),(0,r.useEffect)(()=>{if(!(null==a?void 0:a.user))return;let e=n.O.channel("public:notifications").on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:"user_id=eq.".concat(a.user.id)},e=>{console.log("Notification table change detected:",e.eventType),h()}).subscribe(),t=n.O.channel("private-messages-for-".concat(a.user.id));return t.on("broadcast",{event:"new-message"},e=>{let{payload:t}=e;console.log("New message broadcast received in context:",t),h();let a=window.location.pathname,r=new URLSearchParams(window.location.search);a.startsWith("/messages")&&r.get("with")===t.message.sender_id||i.ZP.custom(e=>(0,s.jsx)(c,{message:t.message.content,sender:t.message.sender.first_name||"New Message",onClose:()=>i.ZP.dismiss(e.id)}),{position:"bottom-right"})}).subscribe(),()=>{n.O.removeChannel(e),n.O.removeChannel(t)}},[a,h]);let g=async e=>{if(!(null==a?void 0:a.user))return;let t=n.O.from("notifications").update({read:!0});e?t.eq("id",e):t.eq("user_id",a.user.id).eq("read",!1);let{error:s}=await t;s?console.error("Error marking notification as read:",s):(u(t=>t.map(t=>(e?t.id!==e:t.read)?t:{...t,read:!0})),m(e?Math.max(0,f-1):0))};return(0,s.jsx)(d.Provider,{value:{notifications:o,unreadCount:f,markAsRead:g,fetchNotifications:h},children:t})},f=()=>{let e=(0,r.useContext)(d);if(void 0===e)throw Error("useNotifications must be used within a NotificationProvider");return e}},7905:function(e,t,a){"use strict";a.d(t,{O:function(){return n}});var s=a(9066),r=a(257);let n=(0,s.eI)(r.env.REACT_APP_SUPABASE_URL,r.env.REACT_APP_SUPABASE_ANON_KEY)}},function(e){e.O(0,[328,647,362,779,145,64,346,971,117,744],function(){return e(e.s=8225)}),_N_E=e.O()}]);